<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover, maximum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="theme-color" content="#000000">
    <title>Reels</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800;900&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg: #000;
            --card: #111;
            --card-2: #1a1a1a;
            --border: rgba(255,255,255,0.1);
            --text: #fff;
            --text-2: rgba(255,255,255,0.7);
            --text-3: rgba(255,255,255,0.45);
            --accent: #ff6b00;
            --accent-2: #ff8c00;
            --green: #00d47b;
            --purple: #9b6dff;
            --yellow: #ffc107;
            --yellow-soft: rgba(255,193,7,0.15);
            --red: #ff4757;
            --safe-top: env(safe-area-inset-top, 47px);
            --safe-bottom: env(safe-area-inset-bottom, 34px);
            --tab-h: 76px;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; -webkit-tap-highlight-color: transparent; -webkit-user-select: none; user-select: none; }
        html, body { height: 100%; overflow: hidden; background: var(--bg); }
        body { font-family: 'Inter', -apple-system, sans-serif; color: var(--text); }

        .app {
            height: 100%;
            display: flex;
            flex-direction: column;
            padding-top: var(--safe-top);
            padding-bottom: calc(var(--tab-h) + var(--safe-bottom));
        }

        .page { display: none; flex: 1; overflow-y: auto; -webkit-overflow-scrolling: touch; }
        .page.active { display: block; }
        .page::-webkit-scrollbar { display: none; }
        .wrap { padding: 0 16px 100px; max-width: 500px; margin: 0 auto; }

        /* Header */
        .hdr { padding: 14px 16px 16px; display: flex; justify-content: space-between; align-items: center; }
        .hdr h1 { font-size: 32px; font-weight: 900; letter-spacing: -1px; }
        .hdr-btn {
            width: 50px; height: 50px;
            background: var(--card);
            border: 1px solid var(--border);
            border-radius: 16px;
            font-size: 22px;
            display: flex; align-items: center; justify-content: center;
            cursor: pointer;
        }
        .hdr-btn:active { transform: scale(0.92); }

        /* Stats Row */
        .stats { display: flex; gap: 10px; margin-bottom: 18px; }
        .stat {
            flex: 1;
            background: var(--card);
            border: 1px solid var(--border);
            border-radius: 20px;
            padding: 16px 12px;
            text-align: center;
        }
        .stat-val { font-size: 32px; font-weight: 900; letter-spacing: -1px; }
        .stat-val.orange { color: var(--accent); }
        .stat-val.green { color: var(--green); }
        .stat-val.purple { color: var(--purple); }
        .stat-lbl { font-size: 11px; color: var(--text-3); text-transform: uppercase; font-weight: 700; margin-top: 4px; }

        /* Big Add Button */
        .add-btn {
            width: 100%;
            padding: 22px;
            background: linear-gradient(135deg, var(--accent), var(--accent-2));
            border: none;
            border-radius: 22px;
            font-size: 18px;
            font-weight: 800;
            color: #000;
            font-family: inherit;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 12px;
            margin-bottom: 24px;
            box-shadow: 0 10px 40px rgba(255,107,0,0.35);
        }
        .add-btn:active { transform: scale(0.97); }
        .add-btn span { font-size: 24px; }

        /* Section Header */
        .sec-hdr { display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px; }
        .sec-title { font-size: 20px; font-weight: 800; }
        .sec-btn { font-size: 14px; font-weight: 700; color: var(--accent); background: none; border: none; cursor: pointer; }

        /* Cards */
        .cards { display: flex; flex-direction: column; gap: 16px; }

        .card {
            background: var(--card);
            border: 1px solid var(--border);
            border-radius: 24px;
            overflow: hidden;
        }

        /* ‚≠ê BIG FAVORITE BUTTON - FIRST THING USER SEES */
        .card-fav-bar {
            padding: 14px 16px;
            background: var(--card-2);
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid var(--border);
        }

        .card-date {
            font-size: 13px;
            color: var(--text-3);
            font-weight: 500;
        }

        /* THE BIG YELLOW FAVORITE BUTTON */
        .fav-btn-big {
            padding: 12px 20px;
            background: var(--yellow-soft);
            border: 2px solid rgba(255,193,7,0.3);
            border-radius: 14px;
            font-size: 15px;
            font-weight: 800;
            color: var(--yellow);
            font-family: inherit;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: all 0.2s;
        }

        .fav-btn-big:active { transform: scale(0.94); }

        .fav-btn-big.on {
            background: var(--yellow);
            border-color: var(--yellow);
            color: #000;
        }

        .fav-btn-big .star { font-size: 18px; }

        /* Card Body */
        .card-body { padding: 18px; }

        .card-tag {
            display: inline-block;
            font-size: 12px;
            font-weight: 700;
            padding: 6px 14px;
            background: var(--card-2);
            border-radius: 10px;
            color: var(--text-2);
            margin-bottom: 12px;
        }

        .card-hook {
            font-size: 18px;
            font-weight: 800;
            line-height: 1.4;
            margin-bottom: 16px;
        }

        .card-stats {
            display: flex;
            gap: 20px;
            margin-bottom: 18px;
        }

        .card-stat {
            display: flex;
            align-items: center;
            gap: 6px;
            font-size: 15px;
        }

        .card-stat-v { font-weight: 800; }
        .card-stat-v.orange { color: var(--accent); }
        .card-stat-v.purple { color: var(--purple); }
        .card-stat-v.green { color: var(--green); }

        /* Card Actions */
        .card-btns {
            display: flex;
            gap: 10px;
        }

        .card-btn {
            flex: 1;
            padding: 16px;
            background: var(--card-2);
            border: 1px solid var(--border);
            border-radius: 14px;
            font-size: 15px;
            font-weight: 700;
            color: var(--text-2);
            font-family: inherit;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .card-btn:active { transform: scale(0.95); }
        .card-btn.link { background: var(--accent); border-color: var(--accent); color: #000; }
        .card-btn.del { color: var(--red); }

        /* Empty */
        .empty { padding: 60px 20px; text-align: center; }
        .empty-icon { font-size: 56px; margin-bottom: 18px; opacity: 0.3; }
        .empty-text { font-size: 18px; font-weight: 700; color: var(--text-3); }
        .empty-sub { font-size: 14px; color: var(--text-3); margin-top: 8px; opacity: 0.6; }

        /* ========== ANALYTICS ========== */
        .page-hdr { padding: 20px 0 24px; text-align: center; }
        .page-hdr h1 { font-size: 30px; font-weight: 900; margin-bottom: 6px; }
        .page-hdr p { font-size: 14px; color: var(--text-3); }

        .a-cards { display: flex; flex-direction: column; gap: 16px; }
        .a-card { background: var(--card); border: 1px solid var(--border); border-radius: 24px; padding: 22px; }
        .a-head { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; }
        .a-title { font-size: 15px; font-weight: 700; color: var(--text-2); }
        .a-val { font-size: 20px; font-weight: 900; color: var(--accent); }

        .chart { display: flex; align-items: flex-end; gap: 8px; height: 140px; }
        .chart-col { flex: 1; display: flex; flex-direction: column; align-items: center; gap: 10px; }
        .chart-bar-w { width: 100%; height: 110px; display: flex; align-items: flex-end; justify-content: center; }
        .chart-bar { width: 100%; max-width: 34px; background: linear-gradient(180deg, var(--accent) 0%, rgba(255,107,0,0.2) 100%); border-radius: 8px 8px 0 0; min-height: 6px; transition: height 0.6s ease; }
        .chart-lbl { font-size: 12px; font-weight: 700; color: var(--text-3); }

        .avg-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 12px; }
        .avg-card { background: var(--card-2); border-radius: 18px; padding: 18px 12px; text-align: center; }
        .avg-icon { font-size: 24px; margin-bottom: 10px; }
        .avg-val { font-size: 24px; font-weight: 900; margin-bottom: 4px; }
        .avg-val.orange { color: var(--accent); }
        .avg-val.purple { color: var(--purple); }
        .avg-val.green { color: var(--green); }
        .avg-lbl { font-size: 10px; color: var(--text-3); text-transform: uppercase; font-weight: 600; }

        .fmt-list { display: flex; flex-direction: column; gap: 14px; }
        .fmt-row { display: flex; align-items: center; gap: 14px; }
        .fmt-icon { width: 48px; height: 48px; background: var(--card-2); border-radius: 14px; display: flex; align-items: center; justify-content: center; font-size: 22px; }
        .fmt-info { flex: 1; }
        .fmt-name { font-size: 15px; font-weight: 700; margin-bottom: 8px; }
        .fmt-bar { height: 10px; background: var(--card-2); border-radius: 5px; overflow: hidden; }
        .fmt-bar-fill { height: 100%; background: linear-gradient(90deg, var(--accent), var(--accent-2)); border-radius: 5px; }
        .fmt-cnt { font-size: 20px; font-weight: 900; color: var(--accent); min-width: 40px; text-align: right; }

        .top-list { display: flex; flex-direction: column; gap: 12px; }
        .top-item { display: flex; align-items: center; gap: 14px; padding: 16px; background: var(--card-2); border-radius: 18px; cursor: pointer; }
        .top-item:active { transform: scale(0.98); }
        .top-rank { width: 34px; height: 34px; border-radius: 10px; display: flex; align-items: center; justify-content: center; font-size: 14px; font-weight: 900; }
        .top-rank.r1 { background: linear-gradient(135deg, #fbbf24, #f59e0b); color: #000; }
        .top-rank.r2 { background: linear-gradient(135deg, #9ca3af, #6b7280); color: #000; }
        .top-rank.r3 { background: linear-gradient(135deg, #d97706, #b45309); color: #fff; }
        .top-rank.r4 { background: var(--card); color: var(--text-3); }
        .top-info { flex: 1; min-width: 0; }
        .top-hook { font-size: 14px; font-weight: 700; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; margin-bottom: 4px; }
        .top-meta { font-size: 12px; color: var(--text-3); }
        .top-meta span { color: var(--accent); font-weight: 700; }
        .top-views { font-size: 17px; font-weight: 900; color: var(--accent); }

        /* ========== FAVORITES ========== */
        .fav-badge { display: inline-flex; align-items: center; gap: 8px; padding: 12px 20px; background: rgba(155,109,255,0.15); border-radius: 22px; font-size: 15px; font-weight: 800; color: var(--purple); margin-top: 14px; }

        /* ========== TABS ========== */
        .tabs {
            position: fixed;
            bottom: 0; left: 0; right: 0;
            height: calc(var(--tab-h) + var(--safe-bottom));
            padding-bottom: var(--safe-bottom);
            background: rgba(8,8,8,0.96);
            backdrop-filter: blur(30px);
            -webkit-backdrop-filter: blur(30px);
            border-top: 1px solid var(--border);
            display: flex;
            z-index: 100;
        }
        .tab {
            flex: 1;
            display: flex; flex-direction: column;
            align-items: center; justify-content: center;
            gap: 4px;
            background: none; border: none;
            cursor: pointer;
        }
        .tab-icon { font-size: 28px; transition: transform 0.2s; }
        .tab-lbl { font-size: 11px; font-weight: 600; color: var(--text-3); }
        .tab.on .tab-icon { transform: scale(1.12); }
        .tab.on .tab-lbl { color: var(--accent); }
        .tab:active .tab-icon { transform: scale(0.9); }

        /* ========== MODALS ========== */
        .modal-bg {
            position: fixed; inset: 0;
            background: rgba(0,0,0,0.92);
            backdrop-filter: blur(24px);
            -webkit-backdrop-filter: blur(24px);
            z-index: 200;
            opacity: 0; visibility: hidden;
            transition: all 0.3s;
        }
        .modal-bg.open { opacity: 1; visibility: visible; }

        .modal {
            position: absolute;
            bottom: 0; left: 0; right: 0;
            background: #0a0a0a;
            border: 1px solid var(--border);
            border-bottom: none;
            border-radius: 30px 30px 0 0;
            max-height: 94vh;
            overflow-y: auto;
            padding: 14px 22px calc(var(--safe-bottom) + 26px);
            transform: translateY(100%);
            transition: transform 0.4s cubic-bezier(0.32, 0.72, 0, 1);
        }
        .modal-bg.open .modal { transform: translateY(0); }

        .modal-bar { width: 44px; height: 5px; background: rgba(255,255,255,0.25); border-radius: 3px; margin: 0 auto 22px; }
        .modal-hdr { display: flex; justify-content: space-between; align-items: center; margin-bottom: 26px; }
        .modal-title { font-size: 24px; font-weight: 900; }
        .modal-x {
            width: 44px; height: 44px;
            background: var(--card);
            border: 1px solid var(--border);
            border-radius: 50%;
            font-size: 20px; color: var(--text-3);
            display: flex; align-items: center; justify-content: center;
            cursor: pointer;
        }
        .modal-x:active { transform: scale(0.9); }

        /* Form */
        .field { margin-bottom: 22px; }
        .field-lbl { display: block; font-size: 12px; font-weight: 700; color: var(--text-3); text-transform: uppercase; margin-bottom: 10px; letter-spacing: 0.5px; }
        .field-input {
            width: 100%; padding: 18px;
            background: var(--card);
            border: 1px solid var(--border);
            border-radius: 16px;
            font-size: 17px; color: var(--text);
            font-family: inherit;
        }
        .field-input:focus { outline: none; border-color: var(--accent); background: rgba(255,107,0,0.08); }
        .field-input::placeholder { color: var(--text-3); }
        textarea.field-input { min-height: 100px; resize: none; line-height: 1.5; }
        .field-row { display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; }

        .tags { display: flex; flex-wrap: wrap; gap: 10px; }
        .tag {
            padding: 14px 18px;
            background: var(--card);
            border: 1px solid var(--border);
            border-radius: 14px;
            font-size: 15px; font-weight: 700;
            color: var(--text-2);
            font-family: inherit;
            cursor: pointer;
        }
        .tag.on { background: rgba(255,107,0,0.12); border-color: var(--accent); color: var(--accent); }
        .tag:active { transform: scale(0.95); }

        /* ‚≠ê BIG FAV TOGGLE IN FORM */
        .fav-toggle {
            display: flex; align-items: center; justify-content: space-between;
            padding: 20px;
            background: var(--yellow-soft);
            border: 2px solid rgba(255,193,7,0.3);
            border-radius: 20px;
            cursor: pointer;
            margin-bottom: 24px;
        }
        .fav-toggle.on { background: var(--yellow); border-color: var(--yellow); }
        .fav-toggle:active { transform: scale(0.98); }

        .fav-toggle-left { display: flex; align-items: center; gap: 14px; }
        .fav-toggle-icon { font-size: 32px; }
        .fav-toggle-text { font-size: 17px; font-weight: 800; color: var(--yellow); }
        .fav-toggle.on .fav-toggle-text { color: #000; }
        .fav-toggle-sub { font-size: 13px; color: rgba(255,193,7,0.7); margin-top: 2px; }
        .fav-toggle.on .fav-toggle-sub { color: rgba(0,0,0,0.6); }

        .fav-toggle-sw {
            width: 60px; height: 34px;
            background: rgba(255,193,7,0.3);
            border-radius: 17px;
            position: relative;
        }
        .fav-toggle.on .fav-toggle-sw { background: rgba(0,0,0,0.2); }
        .fav-toggle-sw::after {
            content: '';
            position: absolute;
            top: 4px; left: 4px;
            width: 26px; height: 26px;
            background: var(--yellow);
            border-radius: 50%;
            transition: all 0.3s;
        }
        .fav-toggle.on .fav-toggle-sw::after { left: 30px; background: #fff; }

        .btn-save {
            width: 100%; padding: 20px;
            background: linear-gradient(135deg, var(--accent), var(--accent-2));
            border: none; border-radius: 16px;
            font-size: 18px; font-weight: 800;
            color: #000;
            font-family: inherit;
            cursor: pointer;
            margin-top: 10px;
        }
        .btn-save:active { transform: scale(0.98); }

        .btn-cancel {
            width: 100%; padding: 18px;
            background: none; border: none;
            font-size: 16px; font-weight: 600;
            color: var(--text-3);
            font-family: inherit;
            cursor: pointer;
            margin-top: 8px;
        }

        /* Settings */
        .s-grp { background: var(--card); border: 1px solid var(--border); border-radius: 20px; overflow: hidden; margin-bottom: 16px; }
        .s-row { padding: 18px 20px; display: flex; align-items: center; justify-content: space-between; border-bottom: 1px solid var(--border); }
        .s-row:last-child { border-bottom: none; }
        .s-lbl { font-size: 16px; font-weight: 600; display: flex; align-items: center; gap: 12px; }
        .s-btn { padding: 12px 18px; background: var(--card-2); border: 1px solid var(--border); border-radius: 12px; font-size: 14px; font-weight: 700; color: var(--text); font-family: inherit; cursor: pointer; }
        .s-btn:active { transform: scale(0.95); }
        .s-btn.red { color: var(--red); }

        /* Toast */
        .toast {
            position: fixed;
            bottom: calc(var(--tab-h) + var(--safe-bottom) + 20px);
            left: 50%; transform: translateX(-50%) translateY(40px);
            background: #fff; color: #000;
            padding: 16px 24px;
            border-radius: 18px;
            font-size: 16px; font-weight: 800;
            z-index: 300;
            opacity: 0; pointer-events: none;
            transition: all 0.4s cubic-bezier(0.4,0,0.2,1);
            display: flex; align-items: center; gap: 14px;
            box-shadow: 0 12px 50px rgba(0,0,0,0.5);
        }
        .toast.on { opacity: 1; transform: translateX(-50%) translateY(0); pointer-events: all; }
        .toast-undo { padding: 10px 16px; background: rgba(0,0,0,0.1); border: none; border-radius: 12px; font-size: 14px; font-weight: 800; font-family: inherit; cursor: pointer; }

        @keyframes fadeUp { from { opacity: 0; transform: translateY(16px); } to { opacity: 1; transform: translateY(0); } }
        .anim { animation: fadeUp 0.45s ease forwards; }
        .anim-1 { animation-delay: 0.06s; opacity: 0; }
        .anim-2 { animation-delay: 0.12s; opacity: 0; }
    </style>
</head>
<body>
    <div class="app">
        <!-- HOME -->
        <div class="page active" id="p-home">
            <header class="hdr">
                <h1>Reels</h1>
                <button class="hdr-btn" onclick="haptic();openSettings()">‚öôÔ∏è</button>
            </header>

            <div class="wrap">
                <div class="stats anim">
                    <div class="stat">
                        <div class="stat-val orange" id="s-total">0</div>
                        <div class="stat-lbl">–í—Å–µ–≥–æ</div>
                    </div>
                    <div class="stat">
                        <div class="stat-val green" id="s-week">0</div>
                        <div class="stat-lbl">–ù–µ–¥–µ–ª—è</div>
                    </div>
                    <div class="stat">
                        <div class="stat-val purple" id="s-fav">0</div>
                        <div class="stat-lbl">–ò–∑–±—Ä–∞–Ω–Ω–æ–µ</div>
                    </div>
                </div>

                <button class="add-btn anim anim-1" onclick="haptic();openAdd()">
                    <span>Ôºã</span> –î–æ–±–∞–≤–∏—Ç—å –∞–Ω–∞–ª–∏–∑
                </button>

                <div class="anim anim-2">
                    <div class="sec-hdr">
                        <h2 class="sec-title">–ú–æ–∏ –∞–Ω–∞–ª–∏–∑—ã</h2>
                        <button class="sec-btn" onclick="haptic();exportCSV()">–≠–∫—Å–ø–æ—Ä—Ç ‚Üí</button>
                    </div>
                    <div class="cards" id="cards"></div>
                </div>
            </div>
        </div>

        <!-- ANALYTICS -->
        <div class="page" id="p-analytics">
            <div class="wrap">
                <div class="page-hdr">
                    <h1>üìä –ê–Ω–∞–ª–∏—Ç–∏–∫–∞</h1>
                    <p>–¢–≤–æ–∏ –ø–∞—Ç—Ç–µ—Ä–Ω—ã</p>
                </div>
                <div class="a-cards">
                    <div class="a-card anim">
                        <div class="a-head"><div class="a-title">üìÖ –ü–æ –¥–Ω—è–º</div><div class="a-val" id="a-total">0</div></div>
                        <div class="chart" id="chart"></div>
                    </div>
                    <div class="a-card anim anim-1">
                        <div class="a-head"><div class="a-title">üìà –°—Ä–µ–¥–Ω–∏–µ</div></div>
                        <div class="avg-grid">
                            <div class="avg-card"><div class="avg-icon">üëÄ</div><div class="avg-val orange" id="avg-v">0</div><div class="avg-lbl">Views</div></div>
                            <div class="avg-card"><div class="avg-icon">üîÑ</div><div class="avg-val purple" id="avg-s">0</div><div class="avg-lbl">Shares</div></div>
                            <div class="avg-card"><div class="avg-icon">üí¨</div><div class="avg-val green" id="avg-c">0</div><div class="avg-lbl">Comments</div></div>
                        </div>
                    </div>
                    <div class="a-card anim anim-2">
                        <div class="a-head"><div class="a-title">üé¨ –§–æ—Ä–º–∞—Ç—ã</div></div>
                        <div class="fmt-list" id="fmt-list"></div>
                    </div>
                    <div class="a-card">
                        <div class="a-head"><div class="a-title">üèÜ –¢–æ–ø</div></div>
                        <div class="top-list" id="top-list"></div>
                    </div>
                </div>
            </div>
        </div>

        <!-- FAVORITES -->
        <div class="page" id="p-fav">
            <div class="wrap">
                <div class="page-hdr">
                    <h1>‚≠ê –ò–∑–±—Ä–∞–Ω–Ω–æ–µ</h1>
                    <p>–î–ª—è –∏–∑—É—á–µ–Ω–∏—è</p>
                    <div class="fav-badge"><span>‚≠ê</span><span id="fav-badge">0</span></div>
                </div>
                <div class="cards" id="fav-cards"></div>
            </div>
        </div>
    </div>

    <!-- Tabs -->
    <nav class="tabs">
        <button class="tab on" data-p="home" onclick="goTab('home')"><span class="tab-icon">üè†</span><span class="tab-lbl">–ì–ª–∞–≤–Ω–∞—è</span></button>
        <button class="tab" data-p="analytics" onclick="goTab('analytics')"><span class="tab-icon">üìä</span><span class="tab-lbl">–ê–Ω–∞–ª–∏—Ç–∏–∫–∞</span></button>
        <button class="tab" data-p="fav" onclick="goTab('fav')"><span class="tab-icon">‚≠ê</span><span class="tab-lbl">–ò–∑–±—Ä–∞–Ω–Ω–æ–µ</span></button>
    </nav>

    <!-- Add Modal -->
    <div class="modal-bg" id="m-add">
        <div class="modal">
            <div class="modal-bar"></div>
            <div class="modal-hdr">
                <h3 class="modal-title" id="m-title">–ù–æ–≤—ã–π –∞–Ω–∞–ª–∏–∑</h3>
                <button class="modal-x" onclick="haptic();closeAdd()">‚úï</button>
            </div>
            <form id="form" onsubmit="return false">
                <input type="hidden" id="edit-id">

                <!-- ‚≠ê HUGE FAV TOGGLE -->
                <div class="fav-toggle" id="fav-toggle" onclick="toggleFavForm()">
                    <div class="fav-toggle-left">
                        <span class="fav-toggle-icon">‚≠ê</span>
                        <div>
                            <div class="fav-toggle-text">–í –∏–∑–±—Ä–∞–Ω–Ω–æ–µ</div>
                            <div class="fav-toggle-sub">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –¥–ª—è –∏–∑—É—á–µ–Ω–∏—è</div>
                        </div>
                    </div>
                    <div class="fav-toggle-sw"></div>
                </div>

                <div class="field">
                    <label class="field-lbl">–•—É–∫ *</label>
                    <textarea class="field-input" id="f-hook" placeholder="–ß—Ç–æ –∑–∞—Ü–µ–ø–∏–ª–æ –≤ –ø–µ—Ä–≤—ã–µ —Å–µ–∫—É–Ω–¥—ã?"></textarea>
                </div>
                <div class="field">
                    <label class="field-lbl">–°—Å—ã–ª–∫–∞</label>
                    <input type="url" class="field-input" id="f-link" placeholder="https://instagram.com/reel/...">
                </div>
                <div class="field">
                    <label class="field-lbl">–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</label>
                    <div class="field-row">
                        <input type="text" class="field-input" id="f-views" placeholder="Views">
                        <input type="text" class="field-input" id="f-shares" placeholder="Shares">
                        <input type="text" class="field-input" id="f-comments" placeholder="Comments">
                    </div>
                </div>
                <div class="field">
                    <label class="field-lbl">–§–æ—Ä–º–∞—Ç</label>
                    <div class="tags">
                        <button type="button" class="tag" data-f="–ì–æ–ª–æ–≤–∞" onclick="pickTag(this)">üó£ –ì–æ–ª–æ–≤–∞</button>
                        <button type="button" class="tag" data-f="–°–ø–ª–∏—Ç" onclick="pickTag(this)">üì± –°–ø–ª–∏—Ç</button>
                        <button type="button" class="tag" data-f="B-roll" onclick="pickTag(this)">üé• B-roll</button>
                        <button type="button" class="tag" data-f="–î–∏–∞–ª–æ–≥" onclick="pickTag(this)">üé≠ –î–∏–∞–ª–æ–≥</button>
                        <button type="button" class="tag" data-f="–¢—É—Ç–æ—Ä–∏–∞–ª" onclick="pickTag(this)">üìö –¢—É—Ç–æ—Ä–∏–∞–ª</button>
                    </div>
                    <input type="hidden" id="f-format">
                </div>
                <div class="field">
                    <label class="field-lbl">–ü–æ—á–µ–º—É —Å—Ä–∞–±–æ—Ç–∞–ª–æ?</label>
                    <textarea class="field-input" id="f-insight" placeholder="–¢–≤–æ–∏ –º—ã—Å–ª–∏..."></textarea>
                </div>
                <button type="button" class="btn-save" onclick="save()">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
                <button type="button" class="btn-cancel" onclick="closeAdd()">–û—Ç–º–µ–Ω–∞</button>
            </form>
        </div>
    </div>

    <!-- Settings -->
    <div class="modal-bg" id="m-settings">
        <div class="modal">
            <div class="modal-bar"></div>
            <div class="modal-hdr">
                <h3 class="modal-title">–ù–∞—Å—Ç—Ä–æ–π–∫–∏</h3>
                <button class="modal-x" onclick="haptic();closeSettings()">‚úï</button>
            </div>
            <div class="s-grp">
                <div class="s-row"><span class="s-lbl">üì§ CSV</span><button class="s-btn" onclick="haptic();exportCSV()">–°–∫–∞—á–∞—Ç—å</button></div>
                <div class="s-row"><span class="s-lbl">üì• –ò–º–ø–æ—Ä—Ç</span><button class="s-btn" onclick="$('imp-csv').click()">–ó–∞–≥—Ä—É–∑–∏—Ç—å</button><input type="file" id="imp-csv" accept=".csv" hidden onchange="importCSV(this)"></div>
            </div>
            <div class="s-grp">
                <div class="s-row"><span class="s-lbl">üíæ Backup</span><button class="s-btn" onclick="haptic();exportJSON()">JSON</button></div>
                <div class="s-row"><span class="s-lbl">üìÇ Restore</span><button class="s-btn" onclick="$('imp-json').click()">–ó–∞–≥—Ä—É–∑–∏—Ç—å</button><input type="file" id="imp-json" accept=".json" hidden onchange="importJSON(this)"></div>
            </div>
            <div class="s-grp">
                <div class="s-row"><span class="s-lbl">üóë –û—á–∏—Å—Ç–∏—Ç—å</span><button class="s-btn red" onclick="haptic();clearAll()">–£–¥–∞–ª–∏—Ç—å</button></div>
            </div>
            <button class="btn-cancel" onclick="closeSettings()">–ó–∞–∫—Ä—ã—Ç—å</button>
        </div>
    </div>

    <!-- Toast -->
    <div class="toast" id="toast"><span id="toast-msg">OK</span><button class="toast-undo" id="toast-undo" onclick="undo()">–í–µ—Ä–Ω—É—Ç—å</button></div>

    <script>
        const $ = id => document.getElementById(id);
        let data = [], deleted = null, toastTm = null, curTab = 'home', formFav = false;
        try { data = JSON.parse(localStorage.getItem('reels_data')) || []; } catch { data = []; }

        function haptic(t = 'light') { if ('vibrate' in navigator) navigator.vibrate({ light: 10, medium: 25, success: [15, 50, 15], error: [40, 25, 40] }[t] || 10); }

        document.addEventListener('DOMContentLoaded', () => { updateStats(); renderCards(); });

        function goTab(t) {
            haptic(); curTab = t;
            document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
            document.querySelectorAll('.tab').forEach(b => b.classList.remove('on'));
            $('p-' + t).classList.add('active');
            document.querySelector(`[data-p="${t}"]`).classList.add('on');
            if (t === 'analytics') renderAnalytics();
            if (t === 'fav') renderFavCards();
        }

        function updateStats() {
            $('s-total').textContent = data.length;
            $('s-week').textContent = data.filter(d => new Date(d.date) >= new Date(Date.now() - 7 * 864e5)).length;
            $('s-fav').textContent = data.filter(d => d.favorite).length;
        }

        function renderCards() {
            const el = $('cards');
            if (!data.length) {
                el.innerHTML = `<div class="empty"><div class="empty-icon">üì≠</div><div class="empty-text">–ü–æ–∫–∞ –Ω–µ—Ç –∞–Ω–∞–ª–∏–∑–æ–≤</div><div class="empty-sub">–ù–∞–∂–º–∏ –∫–Ω–æ–ø–∫—É –≤—ã—à–µ</div></div>`;
                return;
            }
            el.innerHTML = data.map((d, i) => `
                <div class="card" style="animation:fadeUp .4s ease forwards;animation-delay:${i * .04}s;opacity:0">
                    <div class="card-fav-bar">
                        <span class="card-date">${fmtDate(d.date)}</span>
                        <button class="fav-btn-big ${d.favorite ? 'on' : ''}" onclick="togFav('${d.id}')">
                            <span class="star">${d.favorite ? '‚≠ê' : '‚òÜ'}</span>
                            ${d.favorite ? '–í –∏–∑–±—Ä–∞–Ω–Ω–æ–º' : '–í –∏–∑–±—Ä–∞–Ω–Ω–æ–µ'}
                        </button>
                    </div>
                    <div class="card-body">
                        ${d.format ? `<span class="card-tag">${d.format}</span>` : ''}
                        <div class="card-hook">${esc(d.hook)}</div>
                        <div class="card-stats">
                            <div class="card-stat">üëÄ <span class="card-stat-v orange">${fmtNum(d.views)}</span></div>
                            <div class="card-stat">üîÑ <span class="card-stat-v purple">${fmtNum(d.shares)}</span></div>
                            <div class="card-stat">üí¨ <span class="card-stat-v green">${fmtNum(d.comments)}</span></div>
                        </div>
                        <div class="card-btns">
                            ${d.link ? `<button class="card-btn link" onclick="window.open('${esc(d.link)}','_blank')">–û—Ç–∫—Ä—ã—Ç—å</button>` : ''}
                            <button class="card-btn" onclick="haptic();edit('${d.id}')">‚úèÔ∏è –ò–∑–º–µ–Ω–∏—Ç—å</button>
                            <button class="card-btn del" onclick="haptic('error');del('${d.id}')">üóë</button>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        function togFav(id) {
            haptic('medium');
            const d = data.find(x => x.id === id);
            if (d) {
                d.favorite = !d.favorite;
                persist(); renderCards(); updateStats();
                if (curTab === 'fav') renderFavCards();
                toast(d.favorite ? '‚≠ê –î–æ–±–∞–≤–ª–µ–Ω–æ –≤ –∏–∑–±—Ä–∞–Ω–Ω–æ–µ!' : '–£–±—Ä–∞–Ω–æ –∏–∑ –∏–∑–±—Ä–∞–Ω–Ω–æ–≥–æ', false);
            }
        }

        function renderFavCards() {
            const favs = data.filter(d => d.favorite);
            $('fav-badge').textContent = `${favs.length} —Ä–æ–ª–∏–∫${favs.length === 1 ? '' : (favs.length < 5 ? '–∞' : '–æ–≤')}`;
            const el = $('fav-cards');
            if (!favs.length) {
                el.innerHTML = `<div class="empty"><div class="empty-icon">‚≠ê</div><div class="empty-text">–ù–µ—Ç –∏–∑–±—Ä–∞–Ω–Ω—ã—Ö</div><div class="empty-sub">–ù–∞–∂–º–∏ –∂—ë–ª—Ç—É—é –∫–Ω–æ–ø–∫—É –Ω–∞ –∫–∞—Ä—Ç–æ—á–∫–µ</div></div>`;
                return;
            }
            el.innerHTML = favs.map((d, i) => `
                <div class="card" style="animation:fadeUp .4s ease forwards;animation-delay:${i * .04}s;opacity:0">
                    <div class="card-fav-bar">
                        <span class="card-date">${fmtDate(d.date)}</span>
                        <button class="fav-btn-big on" onclick="togFav('${d.id}')"><span class="star">‚≠ê</span> –£–±—Ä–∞—Ç—å</button>
                    </div>
                    <div class="card-body">
                        ${d.format ? `<span class="card-tag">${d.format}</span>` : ''}
                        <div class="card-hook">${esc(d.hook)}</div>
                        <div class="card-stats">
                            <div class="card-stat">üëÄ <span class="card-stat-v orange">${fmtNum(d.views)}</span></div>
                            <div class="card-stat">üîÑ <span class="card-stat-v purple">${fmtNum(d.shares)}</span></div>
                            <div class="card-stat">üí¨ <span class="card-stat-v green">${fmtNum(d.comments)}</span></div>
                        </div>
                        <div class="card-btns">
                            ${d.link ? `<button class="card-btn link" onclick="window.open('${esc(d.link)}','_blank')">–û—Ç–∫—Ä—ã—Ç—å</button>` : ''}
                            <button class="card-btn" onclick="haptic();edit('${d.id}')">‚úèÔ∏è –ò–∑–º–µ–Ω–∏—Ç—å</button>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        function renderAnalytics() {
            $('a-total').textContent = data.length;
            const days = ['–ü–Ω', '–í—Ç', '–°—Ä', '–ß—Ç', '–ü—Ç', '–°–±', '–í—Å'];
            const counts = [0, 0, 0, 0, 0, 0, 0];
            data.forEach(d => { const day = new Date(d.date).getDay(); counts[day === 0 ? 6 : day - 1]++; });
            const maxC = Math.max(...counts, 1);
            $('chart').innerHTML = days.map((d, i) => `<div class="chart-col"><div class="chart-bar-w"><div class="chart-bar" style="height:${Math.max(6, (counts[i] / maxC) * 110)}px"></div></div><span class="chart-lbl">${d}</span></div>`).join('');

            if (data.length) {
                $('avg-v').textContent = fmtNum(Math.round(data.reduce((s, d) => s + (d.views || 0), 0) / data.length));
                $('avg-s').textContent = fmtNum(Math.round(data.reduce((s, d) => s + (d.shares || 0), 0) / data.length));
                $('avg-c').textContent = fmtNum(Math.round(data.reduce((s, d) => s + (d.comments || 0), 0) / data.length));
            }

            const icons = { '–ì–æ–ª–æ–≤–∞': 'üó£', '–°–ø–ª–∏—Ç': 'üì±', 'B-roll': 'üé•', '–î–∏–∞–ª–æ–≥': 'üé≠', '–¢—É—Ç–æ—Ä–∏–∞–ª': 'üìö' };
            const formats = {};
            data.forEach(d => { if (d.format) formats[d.format] = (formats[d.format] || 0) + 1; });
            const fList = Object.entries(formats).sort((a, b) => b[1] - a[1]).slice(0, 5);
            const maxF = fList[0]?.[1] || 1;
            $('fmt-list').innerHTML = fList.length ? fList.map(([n, c]) => `<div class="fmt-row"><div class="fmt-icon">${icons[n] || 'üìÑ'}</div><div class="fmt-info"><div class="fmt-name">${n}</div><div class="fmt-bar"><div class="fmt-bar-fill" style="width:${(c / maxF) * 100}%"></div></div></div><div class="fmt-cnt">${c}</div></div>`).join('') : '<div class="empty"><div class="empty-text">–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö</div></div>';

            const top = [...data].sort((a, b) => (b.views || 0) - (a.views || 0)).slice(0, 5);
            $('top-list').innerHTML = top.length ? top.map((d, i) => `<div class="top-item" onclick="haptic();edit('${d.id}')"><div class="top-rank ${['r1', 'r2', 'r3', 'r4', 'r4'][i]}">${i + 1}</div><div class="top-info"><div class="top-hook">${esc(d.hook)}</div><div class="top-meta">${d.format || ''} ¬∑ <span>${fmtNum(d.shares)}</span></div></div><div class="top-views">${fmtNum(d.views)}</div></div>`).join('') : '<div class="empty"><div class="empty-text">–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö</div></div>';
        }

        function openAdd() {
            $('m-title').textContent = '–ù–æ–≤—ã–π –∞–Ω–∞–ª–∏–∑';
            $('form').reset();
            $('edit-id').value = '';
            $('f-format').value = '';
            formFav = false;
            $('fav-toggle').classList.remove('on');
            document.querySelectorAll('.tag').forEach(t => t.classList.remove('on'));
            $('m-add').classList.add('open');
        }

        function closeAdd() { $('m-add').classList.remove('open'); }

        function toggleFavForm() { haptic('medium'); formFav = !formFav; $('fav-toggle').classList.toggle('on', formFav); }

        function pickTag(btn) { haptic(); document.querySelectorAll('.tag').forEach(t => t.classList.remove('on')); btn.classList.add('on'); $('f-format').value = btn.dataset.f; }

        function save() {
            const hook = $('f-hook').value.trim();
            if (!hook) { haptic('error'); alert('–í–≤–µ–¥–∏ —Ö—É–∫!'); return; }
            const editId = $('edit-id').value;
            const isEdit = editId !== '';
            const entry = {
                id: isEdit ? editId : Date.now().toString(),
                date: isEdit ? (data.find(d => d.id === editId)?.date || new Date().toISOString().split('T')[0]) : new Date().toISOString().split('T')[0],
                hook,
                link: $('f-link').value.trim(),
                views: parseNum($('f-views').value),
                shares: parseNum($('f-shares').value),
                comments: parseNum($('f-comments').value),
                format: $('f-format').value,
                insight: $('f-insight').value.trim(),
                favorite: formFav
            };
            if (isEdit) { const i = data.findIndex(d => d.id === editId); if (i > -1) data[i] = entry; }
            else { data.unshift(entry); }
            persist(); closeAdd(); updateStats(); renderCards();
            if (curTab === 'analytics') renderAnalytics();
            if (curTab === 'fav') renderFavCards();
            haptic('success');
            toast(isEdit ? '–°–æ—Ö—Ä–∞–Ω–µ–Ω–æ ‚úì' : (formFav ? '‚≠ê –î–æ–±–∞–≤–ª–µ–Ω–æ –≤ –∏–∑–±—Ä–∞–Ω–Ω–æ–µ!' : '–î–æ–±–∞–≤–ª–µ–Ω–æ ‚úì'), false);
        }

        function edit(id) {
            const d = data.find(x => x.id === id);
            if (!d) return;
            $('m-title').textContent = '–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å';
            $('edit-id').value = id;
            $('f-hook').value = d.hook;
            $('f-link').value = d.link || '';
            $('f-views').value = d.views ? fmtNum(d.views) : '';
            $('f-shares').value = d.shares ? fmtNum(d.shares) : '';
            $('f-comments').value = d.comments ? fmtNum(d.comments) : '';
            $('f-format').value = d.format || '';
            $('f-insight').value = d.insight || '';
            formFav = d.favorite || false;
            $('fav-toggle').classList.toggle('on', formFav);
            document.querySelectorAll('.tag').forEach(t => t.classList.toggle('on', t.dataset.f === d.format));
            $('m-add').classList.add('open');
        }

        function del(id) {
            const i = data.findIndex(d => d.id === id);
            if (i === -1) return;
            deleted = data[i]; data.splice(i, 1);
            persist(); updateStats(); renderCards();
            if (curTab === 'fav') renderFavCards();
            toast('–£–¥–∞–ª–µ–Ω–æ', true);
        }

        function undo() { if (!deleted) return; data.unshift(deleted); deleted = null; persist(); updateStats(); renderCards(); haptic('success'); hideToast(); }

        function openSettings() { $('m-settings').classList.add('open'); }
        function closeSettings() { $('m-settings').classList.remove('open'); }

        function exportCSV() {
            if (!data.length) { toast('–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö', false); return; }
            let csv = '\uFEFF–î–∞—Ç–∞,–•—É–∫,–§–æ—Ä–º–∞—Ç,–ü—Ä–æ—Å–º–æ—Ç—Ä—ã,–†–µ–ø–æ—Å—Ç—ã,–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏,–°—Å—ã–ª–∫–∞,–ò–Ω—Å–∞–π—Ç,–ò–∑–±—Ä–∞–Ω–Ω–æ–µ\n';
            data.forEach(d => { csv += `"${fmtDateFull(d.date)}","${escCSV(d.hook)}","${d.format || ''}",${d.views || 0},${d.shares || 0},${d.comments || 0},"${d.link || ''}","${escCSV(d.insight)}","${d.favorite ? '–î–∞' : '–ù–µ—Ç'}"\n`; });
            download(csv, `Reels_${fmtFile()}.csv`, 'text/csv;charset=utf-8');
            haptic('success'); toast('–≠–∫—Å–ø–æ—Ä—Ç –≥–æ—Ç–æ–≤ ‚úì', false); closeSettings();
        }

        function importCSV(input) {
            const file = input.files[0]; if (!file) return;
            const reader = new FileReader();
            reader.onload = e => {
                const lines = e.target.result.split('\n').filter(l => l.trim()).slice(1);
                const newData = lines.map(row => {
                    const c = parseRow(row);
                    if (c.length < 2) return null;
                    return { id: Date.now().toString() + Math.random().toString(36).substr(2, 9), date: parseDate(c[0]) || new Date().toISOString().split('T')[0], hook: c[1] || '', format: c[2] || '', views: parseNum(c[3]), shares: parseNum(c[4]), comments: parseNum(c[5]), link: c[6] || '', insight: c[7] || '', favorite: c[8]?.toLowerCase().includes('–¥–∞') };
                }).filter(Boolean);
                if (!newData.length) { haptic('error'); alert('–û—à–∏–±–∫–∞'); return; }
                data = [...newData, ...data];
                persist(); updateStats(); renderCards(); closeSettings();
                haptic('success'); toast(`–ò–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–æ ${newData.length} ‚úì`, false);
            };
            reader.readAsText(file); input.value = '';
        }

        function parseRow(row) { const r = []; let cur = '', inQ = false; for (const ch of row) { if (ch === '"') inQ = !inQ; else if ((ch === ',' || ch === ';') && !inQ) { r.push(cur.trim()); cur = ''; } else cur += ch; } r.push(cur.trim()); return r; }

        function exportJSON() { download(JSON.stringify({ v: '10.0', data }, null, 2), `Reels_Backup_${fmtFile()}.json`, 'application/json'); haptic('success'); toast('Backup ‚úì', false); }

        function importJSON(input) {
            const file = input.files[0]; if (!file) return;
            const reader = new FileReader();
            reader.onload = e => { try { const imp = JSON.parse(e.target.result); if (imp.data) { data = imp.data; persist(); updateStats(); renderCards(); closeSettings(); haptic('success'); toast('–í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ ‚úì', false); } } catch { haptic('error'); alert('–û—à–∏–±–∫–∞'); } };
            reader.readAsText(file); input.value = '';
        }

        function clearAll() { if (!confirm('–£–¥–∞–ª–∏—Ç—å –í–°–ï?')) return; data = []; persist(); updateStats(); renderCards(); closeSettings(); toast('–û—á–∏—â–µ–Ω–æ', false); }

        function toast(msg, showUndo) { $('toast-msg').textContent = msg; $('toast-undo').style.display = showUndo ? 'inline-block' : 'none'; clearTimeout(toastTm); $('toast').classList.add('on'); toastTm = setTimeout(hideToast, showUndo ? 4000 : 2500); }
        function hideToast() { $('toast').classList.remove('on'); }

        function persist() { localStorage.setItem('reels_data', JSON.stringify(data)); }

        function parseNum(s) { if (!s) return 0; s = String(s).toLowerCase().replace(/\s/g, '').replace(/[–ºm]/g, 'm').replace(/[–∫k]/g, 'k'); if (s.includes('m')) return Math.round(parseFloat(s) * 1e6); if (s.includes('k')) return Math.round(parseFloat(s) * 1e3); return parseInt(s.replace(/\D/g, '')) || 0; }
        function fmtNum(n) { if (!n) return '0'; n = +n; if (n >= 1e6) return (n / 1e6).toFixed(1).replace(/\.0$/, '') + '–º'; if (n >= 1e3) return (n / 1e3).toFixed(1).replace(/\.0$/, '') + '–∫'; return String(n); }
        function fmtDate(s) { if (!s) return ''; const d = new Date(s); const m = ['—è–Ω–≤', '—Ñ–µ–≤', '–º–∞—Ä', '–∞–ø—Ä', '–º–∞—è', '–∏—é–Ω', '–∏—é–ª', '–∞–≤–≥', '—Å–µ–Ω', '–æ–∫—Ç', '–Ω–æ—è', '–¥–µ–∫']; return `${d.getDate()} ${m[d.getMonth()]}`; }
        function fmtDateFull(s) { if (!s) return ''; const d = new Date(s); return `${d.getDate().toString().padStart(2, '0')}.${(d.getMonth() + 1).toString().padStart(2, '0')}.${d.getFullYear()}`; }
        function fmtFile() { const d = new Date(); return `${d.getFullYear()}-${(d.getMonth() + 1).toString().padStart(2, '0')}-${d.getDate().toString().padStart(2, '0')}`; }
        function parseDate(s) { if (!s) return null; const p = s.split('.'); if (p.length === 3) return `${p[2]}-${p[1].padStart(2, '0')}-${p[0].padStart(2, '0')}`; if (s.includes('-')) return s; return null; }
        function esc(s) { return s ? String(s).replace(/&/g, '&amp;').replace(/</g, '&lt;').replace(/>/g, '&gt;').replace(/"/g, '&quot;') : ''; }
        function escCSV(s) { return s ? String(s).replace(/"/g, '""') : ''; }
        function download(content, name, type) { const a = document.createElement('a'); a.href = URL.createObjectURL(new Blob([content], { type })); a.download = name; a.click(); }

        document.querySelectorAll('.modal-bg').forEach(m => { m.addEventListener('click', e => { if (e.target === m) { haptic(); m.classList.remove('open'); } }); });
    </script>
</body>
</html>
